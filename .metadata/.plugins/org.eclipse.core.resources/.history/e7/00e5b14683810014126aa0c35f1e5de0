package com.DR.dLib.ui;

import com.DR.dLib.dObject;
import com.DR.dLib.dValues;
import com.DR.dLib.animations.ExpandAnimation;
import com.DR.dLib.animations.dAnimation;
import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.graphics.Color;
import com.badlogic.gdx.graphics.Texture;
import com.badlogic.gdx.graphics.g2d.Sprite;
import com.badlogic.gdx.graphics.g2d.SpriteBatch;
import com.badlogic.gdx.math.Vector2;

public class dButton extends dObject {

	/*===========================================================================
	*								VARIABLES								 	|
	*===========================================================================*/

	private boolean enabled = true, clicked = false;
	private dText buttonText;
	private float bWidth, bHeight;
	private dImage clickCircle = null;
	private dAnimation circleAnimation = null;
	
	/*===========================================================================
	*							   CONSTRUCTORS								 	|
	*===========================================================================*/
	
	public dButton(float x, float y, Sprite sprite, String text) {
		super(x, y, sprite);
		buttonText = new dText(0,0,18f,text);
		buttonText.setPos(x + getWidth()/2f - buttonText.getWidth()/2f, y + getHeight()/2f - buttonText.getHeight()/2f);
		buttonText.setColor(Color.WHITE);
		bWidth = sprite.getWidth();
		bHeight = sprite.getHeight();
	}
	
	public dButton(float x, float y, Sprite sprite, dText text) {
		super(x, y, sprite);
		buttonText = text;
		bWidth = sprite.getWidth();
		bHeight = sprite.getHeight();
	}
	
	public dButton(float x, float y, Sprite sprite, dText text, Texture circle)
	{
		super(x,y,sprite);
		buttonText = text;
		bWidth = sprite.getWidth();
		bHeight = sprite.getHeight();
		clickCircle = new dImage(getX(),getY(), circle);
		clickCircle.setColor(1f,1f,1f,0.25f);
		clickCircle.setOriginCenter();
		clickCircle.setDimensions(0, 0);
		circleAnimation = new ExpandAnimation(clickCircle, 2f, null, 1, clickCircle.getColor(), getWidth()*2f);
	}
	
	public dButton(float x, float y, Sprite sprite, String text, Texture circle)
	{
		super(x, y, sprite);
		buttonText = new dText(0,0,18f,text);
		buttonText.setPos(x + getWidth()/2f - buttonText.getWidth()/2f, y + getHeight()/2f - buttonText.getHeight()/2f);
		buttonText.setColor(Color.WHITE);
		bWidth = sprite.getWidth();
		bHeight = sprite.getHeight();
		clickCircle = new dImage(getX(),getY(), circle);
		clickCircle.setColor(1f,1f,1f,0.25f);
		clickCircle.setOriginCenter();
		clickCircle.setDimensions(0, 0);
		circleAnimation = new ExpandAnimation(clickCircle, 2f, null, 1, clickCircle.getColor(), getWidth()*2f);
	}


	/*===========================================================================
	*									METHODS								 	|
	*===========================================================================*/
	
	@Override
	public void update(float delta) {
		if(isEnabled())
		{
			checkClicked();
		}
		if(circleAnimation != null && circleAnimation.isActive())
		{
			circleAnimation.update(delta);
		}
	}

	@Override
	public void render(SpriteBatch batch) {
		if(clickCircle != null)
		{
			
			Gdx.gl.glEnable(Gdx.gl20.GL_SCISSOR_TEST);
			Gdx.gl.glScissor((int)getX(), (int)(dValues.camera.position.y + dValues.VH /2f - getY()), (int)getWidth(), (int)getHeight());
			
			clickCircle.render(batch);
			
			batch.flush();
			
			Gdx.gl.glDisable(Gdx.gl20.GL_SCISSOR_TEST);
		}
		getSprite().draw(batch);
		buttonText.render(batch);
	}
	
	private void checkClicked()
	{
		if(getBoundingRectangle().contains(dValues.camera.position.x-dValues.VW/2f + (Gdx.input.getX() / (Gdx.graphics.getWidth() / dValues.VW)),dValues.camera.position.y-dValues.VH/2f + Gdx.input.getY() / (Gdx.graphics.getHeight() / dValues.VH)) && Gdx.input.justTouched())
		{
			clicked = true;
			if(circleAnimation != null)
			{
				circleAnimation.start();
			}
		//	setAlpha(.6f);
		}
		else
		{
			clicked = false;
		//	setAlpha(1f);
		}
	}
	
	/*===========================================================================
	*									SETTERS								 	|
	*===========================================================================*/
	
	public void setEnabled(boolean enabled)
	{
		this.enabled = enabled;
	}
	
	@Override
	public void setPosition(Vector2 pos)
	{
		position = pos;
		getSprite().setPosition(position.x, position.y);
		buttonText.setPos(position.x + getWidth()/2f - buttonText.getWidth()/2f, position.y + getHeight()/2f - buttonText.getHeight()/2f);
	}
	
	@Override
	public void setPosition(float x, float y)
	{
		position.set(x, y);
		getSprite().setPosition(position.x, position.y);
		buttonText.setPos(position.x + getWidth()/2f - buttonText.getWidth()/2f, position.y + getHeight()/2f - buttonText.getHeight()/2f);
	}
	
	@Override
	public void setPos(Vector2 pos)
	{
		position = pos;
		getSprite().setPosition(position.x, position.y);
		buttonText.setPos(position.x + getWidth()/2f - buttonText.getWidth()/2f, position.y + getHeight()/2f - buttonText.getHeight()/2f);
	}
	
	@Override
	public void setPos(float x, float y)
	{
		position.set(x,y);
		getSprite().setPosition(position.x, position.y);
		buttonText.setPos(position.x + getWidth()/2f - buttonText.getWidth()/2f, position.y + getHeight()/2f - buttonText.getHeight()/2f);
	}
	
	@Override
	public void setX(float x)
	{
		position.set(x, position.y);
		getSprite().setPosition(position.x, position.y);
		buttonText.setPos(position.x + getWidth()/2f - buttonText.getWidth()/2f, position.y + getHeight()/2f - buttonText.getHeight()/2f);
	}
	
	@Override
	public void setY(float y)
	{
		position.set(position.x, y);
		getSprite().setPosition(position.x, position.y);
		buttonText.setPos(position.x + getWidth()/2f - buttonText.getWidth()/2f, position.y + getHeight()/2f - buttonText.getHeight()/2f);
	}
	
	public void setText(String text)
	{
		buttonText.setText(text);
	}
	
	public void setTextSize(float size)
	{
		buttonText.setScale(size);
	}
	
	public void setTextColor(Color c)
	{
		buttonText.setColor(c);
	}
	
	public void setWidth(float w)
	{
		bWidth = w;
		this.setScaleX(w/getSprite().getRegionWidth());
	}
	
	public void setHeight(float h)
	{
		bHeight = h;
		setScaleY(h/getSprite().getRegionHeight());
	}
	
	public void setDimensions(float w, float h)
	{
		setWidth(w);
		setHeight(h);
	}
	
	/*===========================================================================
	*									GETTERS								 	|
	*===========================================================================*/
	
	public boolean isClicked()
	{
		return clicked;
	}
	
	public boolean isEnabled()
	{
		return enabled;
	}
	
	@Override
	public float getWidth()
	{
		return bWidth;
	}
	
	@Override
	public float getHeight()
	{
		return bHeight;
	}
	
	public String getText()
	{
		return buttonText.getText();
	}
	
}
